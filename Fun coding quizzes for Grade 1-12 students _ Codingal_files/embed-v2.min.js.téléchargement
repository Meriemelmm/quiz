(function() {!function(){"use strict";function n(n,e,t,o,i,s){let c,a,r;return c=n-o,a=e-i,r=t-s,Math.sqrt(c*c+a*a+r*r)}function e(t,o,i){if(null===t)return console.warn("FastComments: targetElement does not exist!");var s=window.location,c=s.hash;function a(n,e,t){n.setAttribute(e,t)}var r="#fast-comments-jt=";function d(n){JSON.stringify(n)!==JSON.stringify(window.fcLastUserObj)&&(window.fcUIInstances&&window.fcUIInstances.forEach((function(e){if(e&&e.instance)try{e.instance.updateUser(n)}catch(n){console.error(n)}})),window.fcLastUserObj=n)}function l(n){return n.includes(r)&&(n=n.replace(/#fast-comments-jt=.+/,"")),n}null!==o.urlId&&void 0!==o.urlId&&"number"==typeof o.urlId&&(o.urlId=""+o.urlId);let u=!0;const m={targetElement:t,config:o};window.fcUIInstances?window.fcUIInstances.push(m):window.fcUIInstances=[m];const p=window.FastCommentsExtensions||(window.FastCommentsExtensions=[]),f={};for(const n in o)"function"==typeof o[n]&&(f[n]=o[n]);const g=JSON.parse(JSON.stringify(o));for(const n in f)g[n]=1;const w=f.onAuthenticationChange;f.onAuthenticationChange=function(n,e){("logout"===n||"user-set"===n||"session-id-set"===n)&&d(e),w&&w(n,e)};const y=f.onCommentsRendered;f.onCommentsRendered=function(n){u&&(window.fcLastUserObj&&m.instance&&m.instance.updateUser(window.fcLastUserObj),u=!0,y&&y(n))},o.sso&&(o.sso.loginCallback&&(f.loginCallback=o.sso.loginCallback,g.sso.loginCallback=!0),o.sso.logoutCallback&&(f.logoutCallback=o.sso.logoutCallback,g.sso.logoutCallback=!0)),o.simpleSSO&&(o.simpleSSO.loginCallback&&(f.loginCallback=o.simpleSSO.loginCallback,g.simpleSSO.loginCallback=!0),o.simpleSSO.logoutCallback&&(f.logoutCallback=o.simpleSSO.logoutCallback,g.simpleSSO.logoutCallback=!0));let h=g.apiHost?g.apiHost:"https://fastcomments.com",C=0;const I=function(e,t){let o;for(;void 0===e.hasDarkBackground&&void 0===e.wrap&&t&&t.parentNode;){let i=null;try{i=window.getComputedStyle(t,"background")}catch(n){}if(i&&i.backgroundColor){let t=i.backgroundColor;if("rgba(0, 0, 0, 0)"!==t&&"transparent"!==t){o=t;let i=t.substring(t.indexOf("(")+1,t.length-1).split(",");const s=isNaN(i[3])?1:parseFloat(i[3]);i=i.map(((n,e)=>parseInt(n,10))),s<1&&(i[0]=(1-s)*i[0]+s*i[0],i[1]=(1-s)*i[1]+s*i[1],i[2]=(1-s)*i[2]+s*i[2]);const c=.299*i[0]+.587*i[1]+.114*i[2],a=n(0,0,0,i[0],i[1],i[2]);if(c<100&&a<125&&(e.hasDarkBackground=!0),1===s)break}}t=t.parentNode}return o}(g,t);let k=t;for(;void 0===g.hasDarkBackground&&void 0===g.wrap&&k&&k.parentNode;){let e=null;try{e=window.getComputedStyle(k,"background")}catch(n){}if(e&&e.backgroundColor){let t=e.backgroundColor;if("rgba(0, 0, 0, 0)"!==t&&"transparent"!==t){const e=t.substring(t.indexOf("(")+1,t.length-1).split(",").map(((n,e)=>parseInt(n,10)));n(255,255,255,e[0],e[1],e[2])>50&&(g.wrap=!0)}}k=k.parentNode}if(c&&c.indexOf(r)>-1){var b=c.substring(r.length,c.length);b&&(g.jumpToId=b)}const S=s.href?s.href:document.documentURI;g.urlId=l(g.urlId?g.urlId:S),g.url=l(g.url?g.url:S),g.pageTitle=g.pageTitle?g.pageTitle:document.title,g.instanceId=Math.random()+"."+Date.now(),m.config=g,/bot|googlebot|crawler|spider|robot|crawling/i.test(navigator&&navigator.userAgent)&&(m.config.startingPage=-1,g.isCrawler=!0);for(const n in g){const e=g[n];void 0===e?delete g[n]:g[n]="number"==typeof e?e:"object"!=typeof e?encodeURIComponent(e):e}if(g.originalReferrer=window.location.hostname,g.isCrawler){const n=document.createElement("script");n.setAttribute("src",(h||"https://cdn.fastcomments.com")+"/js/comment-ui-v2.min.js"),g.apiHost=h,n.onload=function(){window.FastCommentsUI(t,g)},document.body.appendChild(n)}else{var O=document.createElement("iframe");O.src=h+"/embed?config="+encodeURIComponent(JSON.stringify(g))+"&wId="+i,a(O,"horizontalscrolling","no"),a(O,"verticalscrolling","no"),a(O,"allowtransparency","true"),a(O,"frameborder","0"),a(O,"scrolling","no"),a(O,"title","FastComments"),a(O,"width","100%"),a(O,"style","width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; color-scheme: normal !important;"),t.append(O)}function v(n){(n>C||Math.abs(n-C)>100||0===n)&&(C=n,O.height=n,f.onHeightUpdated&&f.onHeightUpdated(n))}m.requested=!0,"true"===g.readonly&&v(0);let U,N=!1;function E(n,e){let t=n.target;for(;t;){if(t==e)return;t=t.parentNode}O&&O.contentWindow&&O.contentWindow.postMessage(JSON.stringify({type:"click-outside",instanceId:g.instanceId}),"*"),p.forEach((function(n){n.onClickOutside&&n.onClickOutside()}))}function J(n){E(n,t)}function R(n){if(f.onOpenProfile&&f.onOpenProfile({userId:n.userId,currentUser:n.currentUser,comment:n.comment}))return void L(JSON.stringify({type:"profile-loaded",instanceId:g.instanceId}));const e="profile";if(N)p.forEach((function(e){e.openProfile&&(e.config=m.finalConfig,e.openProfile(h,n.userId,I))}));else{const t=document.createElement("script");t.setAttribute("src",h+"/js/comment-ui/extensions/comment-ui.profile.embed-extension.min.js"),t.onload=function(){p.forEach((function(n){n.id===e&&(U=n,U.config=m.finalConfig)})),U.openProfile(h,n.userId,I),document.body.addEventListener("click",(function(n){E(n,U.extRoot)}))},p.push({id:e,scriptNode:t}),document.body.appendChild(t),N=!0}}let j=0;function x(n){if(n.data&&n.origin===h)try{var e=JSON.parse(n.data);if(e.instanceId!==g.instanceId)return;"update-height"===e.type?v(e.height):"update-comment-count"===e.type?f.commentCountUpdated&&f.commentCountUpdated(e.count):"scroll-to-position"===e.type&&e.y>0?window.scrollTo({top:O.getBoundingClientRect().y+window.scrollY+e.y}):"redirect"===e.type?e.isNewWindow?window.open(e.url):window.location=e.url:"update-config"===e.type?m.finalConfig=e.config:"login"===e.type?f.loginCallback&&f.loginCallback(g.instanceId):"logout"===e.type?f.logoutCallback&&f.logoutCallback(g.instanceId):"reply-success"===e.type?f.onReplySuccess&&f.onReplySuccess(e.comment):"vote-success"===e.type?f.onVoteSuccess&&f.onVoteSuccess(e.comment,e.voteId,e.direction,e.status):"on-init"===e.type?f.onInit&&f.onInit():"on-render"===e.type?f.onRender&&f.onRender():"on-image-clicked"===e.type?f.onImageClicked&&f.onImageClicked(e.src):"on-authentication-change"===e.type?f.onAuthenticationChange&&f.onAuthenticationChange(e.changeType,e.data):"on-comments-rendered"===e.type?f.onCommentsRendered&&f.onCommentsRendered(e.comments):"detect-clicks-outside"===e.type?(j||document.body.addEventListener("click",J),j++):"u-b"===e.type?f.onUserBlocked&&f.onUserBlocked(e.userId,e.comment,e.isBlocked):"c-f"===e.type?f.onCommentFlagged&&f.onCommentFlagged(e.userId,e.comment,e.isFlagged):"c-e"===e.type?f.onCommentEdited&&f.onCommentEdited(e.userId,e.comment):"c-d"===e.type?f.onCommentDeleted&&f.onCommentDeleted(e.userId,e.comment):"stop-detect-clicks-outside"===e.type?(j=Math.max(j-1,0),j||document.body.removeEventListener("click",J)):"open-profile"===e.type?R(e):"profile-loaded"===e.type?p.forEach((function(n){n.setLoaded&&(n.setLoaded(),L(JSON.stringify({type:"profile-loaded",instanceId:g.instanceId})))})):"on-c-s-start"===e.type?f.onCommentSubmitStart&&f.onCommentSubmitStart(e.comment,(function(){L(JSON.stringify({type:"on-c-s-continue",instanceId:g.instanceId}))}),(function(n){L(JSON.stringify({type:"on-c-s-cancel",instanceId:g.instanceId,m:n}))})):"fc-session-info"===e.type&&alert(JSON.stringify(e))}catch(e){g.apiHost&&console.error(n,e)}}function B(){t.innerHTML="",window.removeEventListener("message",x,!1);const n=window.fcUIInstances.indexOf(m);n>-1&&window.fcUIInstances.splice(n,1)}function L(n){O&&O.contentWindow&&O.contentWindow.postMessage(n,"*")}window.addEventListener("message",x,!1);const D={id:g.instanceId,destroy:B,update:function(n){const o=[];for(const e in n)JSON.stringify(g[e])!==JSON.stringify(n[e])&&o.push(e);return 1===o.length&&"hasDarkBackground"===o[0]?(g.hasDarkBackground=n.hasDarkBackground,L(JSON.stringify({type:"update-config",k:"hasDarkBackground",v:n.hasDarkBackground,instanceId:g.instanceId})),D):(B(),e(t,n,i))},updateUser:function(n){O&&O.contentWindow&&L(JSON.stringify({type:"update-user",user:n,instanceId:o.instanceId}))},postMessage:L,openProfile:R};m.instance=D;try{window.fcTestAuth=function(){window.open("https://fastcomments.com/cookie-setup")}}catch(n){console.error(n)}return D}window.FastCommentsUI=function(n,t){return e(n,t,"comment-ui-v2")}}();})()